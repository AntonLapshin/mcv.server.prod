function send(e){var o=nodemailer.createTransport("smtps://makemecoolvideo%40gmail.com:24547294@smtp.gmail.com"),t={from:options.from,to:e.to,subject:e.subject,html:e.template.fo(e.body)};o.sendMail(t,function(e,o){return e?console.log(e):void console.log("Message sent: "+o.response)})}function allowCrossDomain(e,o,t){o.header("Access-Control-Allow-Origin","*"),o.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,OPTIONS"),o.header("Access-Control-Allow-Headers","cache-control, x-requested-with, content-type"),t()}function mkdir(e,o){fs.exists(e,function(t){t?o():fs.mkdir(e,function(){o()})})}var nodemailer=require("nodemailer"),options={from:'"MakeCoolVideo" <makemecoolvideo@gmail.com>',manager:"antvallap@gmail.com",siteUrl:"https://makecool.video/"},templates={submit:{en:{subject:"In Progress",template:'<div style="background-color: #202024; width:100%; height: 100; text-align: center; color: white; font-family: Tahoma;padding:0 0 10px 0"> <div style="background-color: #3f3f47"> <a href="{0}"><img src="https://i.snag.gy/6ihwse.jpg" style="width: 250px; margin-top:2px" /></a> </div> <h2 style="font-weight: normal">Your submission has been approved</h2> <p>You will get the video soon. Thank you</p> <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.9em;margin-bottom:10px;margin-top:50px;">Copyright &copy; 2016 Make a cool video</p> </div>'.f(options.siteUrl)},ru:{subject:"Принято в обработку",template:'<div style="background-color: #202024; width:100%; height: 100; text-align: center; color: white; font-family: Tahoma;padding:0 0 10px 0"> <div style="background-color: #3f3f47"> <a href="{0}"><img src="https://i.snag.gy/6ihwse.jpg" style="width: 250px; margin-top:2px" /></a> </div> <h2 style="font-weight: normal">Ваша завяка прината в обработку</h2> <p>Видео скоро будет готово. Спасибо</p> <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.9em;margin-bottom:10px;margin-top:50px;">Copyright &copy; 2016 Make a cool video</p> </div>'.f(options.siteUrl)}},ready:{en:{subject:"Your video is ready",template:""},ru:{subject:"Ваше видео готово",template:""}},order:{subject:"New Order",template:"<h2>We have a new order</h2><p>Language: {lang}</p><p>Price: {price}</p><p>Duration: {duration} minutes</p><p>Template: {template}</p><p>Email: {email}</p><p>External links:</p><ul>{links}</ul><p>Uploaded files:</p><ul>{uploaded}</ul><p>Comments: {comments}</p>",process:function(e){for(var o="",t=0;t<e.names.length;t++)o+='<li><a href="{0}{1}">{1}</a></li>'.f(e.urlToFolder,e.names[t]);e.uploaded=o;for(var r="",t=0;t<e.links.length;t++)r+='<li><a href="{0}">{1}</a></li>'.f(decodeURIComponent(e.links[t]),"file "+t);return e.links=r,e}}};module.exports={send:function(e,o){var t=templates[e],r=o.lang.substr(0,2),a={to:o.email,subject:t[r].subject,template:t[r].template,body:o};send(a)},sendToManager:function(e){var o=templates.order;e=o.process(e);var t={to:options.manager,subject:o.subject,template:o.template,body:e};send(t)}};var express=require("express"),bodyParser=require("body-parser"),fileUpload=require("express-fileupload"),fs=require("fs"),BASE_PATH=__dirname+"/uploads/",port=Number(process.env.PORT||8081);String.prototype.format||(String.prototype.format=String.prototype.f=function(){for(var e=this,o=arguments.length;o--;)e=e.replace(new RegExp("\\{"+o+"\\}","gm"),arguments[o]);return e}),String.prototype.formatO||(String.prototype.formatO=String.prototype.fo=function(e){var o=this;for(var t in e)o=o.replace(new RegExp("\\{{0}\\}".f(t),"gm"),e[t]);return o});var email=require("./email"),app=express();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(fileUpload()),app.use(allowCrossDomain),app.post("/upload",function(e,o){var t=e.query.uid;if(!e.files)return void o.send("No files were uploaded.");var r=BASE_PATH+"/"+t+"/";mkdir(r,function(){var t=e.files.file;t.mv(r+t.name,function(e){e?o.status(500).send(e):o.send("File uploaded!")})})}),app.post("/save",function(e,o){var t=e.body;t.urlToFolder="http://{0}/{1}/".f(e.headers.host,t.uid),email.send("submit",t),email.sendToManager(t),o.end("true")}),mkdir(BASE_PATH,function(){app.use(express["static"]("uploads")),app.listen(port)}),console.log("Server has been started (port = "+port+")");