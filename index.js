function allowCrossDomain(e,r,o){r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,OPTIONS"),r.header("Access-Control-Allow-Headers","cache-control, x-requested-with, content-type"),o()}function getFolderName(e){return new Date(parseInt(e)).toUTCString().replace(/ /gi,"_").replace(/:/gi,"-").replace(/,/gi,"")}var express=require("express"),bodyParser=require("body-parser"),fileUpload=require("express-fileupload"),dropbox=require("./services/dropbox-new"),fs=require("fs");String.prototype.format||(String.prototype.format=String.prototype.f=function(){for(var e=this,r=arguments.length;r--;)e=e.replace(new RegExp("\\{"+r+"\\}","gm"),arguments[r]);return e}),String.prototype.formatO||(String.prototype.formatO=String.prototype.fo=function(e){var r=this;for(var o in e)r=r.replace(new RegExp("\\{{0}\\}".f(o),"gm"),e[o]);return r});var email=require("./services/email"),app=express();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(fileUpload()),app.use(allowCrossDomain),app.post("/upload",function(e,r){if(!e.files)return void r.send("No files were uploaded.");var o="/"+getFolderName(e.query.uid)+"/",t=e.files.file;try{dropbox.createFile(o+t.name,t.data).then(function(e){console.log(e),r.send("File uploaded!")})["catch"](function(e){console.log(e),r.status(500).send(e)})}catch(a){r.status(500).send(a)}}),app.post("/save",function(e,r){var o=e.body,t=getFolderName(o.uid);o.urlToFolder="https://www.dropbox.com/home/Apps/SlideShowPlanet/{0}/".f(t),email.send("submit",o);var a=email.sendToManager(o),n="/"+t+"/";dropbox.createFile(n+"order.html",a),r.end("true")}),app.get("/wakeup",function(e,r){r.end("ok")});var port=Number(process.env.PORT||8081);app.listen(port),console.log("Server has been started (port = "+port+")");